{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm2Home - Fresh Farm to Your Door</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/landing.css' %}">
    <link rel="stylesheet" href="{% static 'css/notifications.css' %}">
    <link rel="stylesheet" href="{% static 'css/modal-auth.css' %}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <span>Farm2Home</span>
            </div>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#benefits">Benefits</a></li>
                <li><a href="#products">Products</a></li>
                <li><a href="#contact">Contact</a></li>
                <li><button type="button" class="auth-btn login-btn" onclick="event.preventDefault(); openLoginModal();">Login</button></li>
                <li><button type="button" class="auth-btn signup-btn" onclick="event.preventDefault(); openSignupModal();">Sign Up</button></li>
                <li><a href="{% url 'main:catalog' %}" class="shop-btn">Shop Now</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section with Background Image -->
    <section class="hero" id="home">
        <div class="hero-bg">
            <img src="{% static 'images/main.png' %}" alt="Farm Background" class="hero-bg-image">
        </div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1 class="hero-title">
                FRESH
                <span class="highlight">FROM FARM</span>
            </h1>
            <p class="hero-subtitle">Directly to your table, no middleman. Just pure, organic goodness.</p>
            <div class="hero-buttons">
                <a href="{% url 'main:catalog' %}" class="btn btn-primary">
                    Explore Products
                    <i class="fas fa-arrow-right"></i>
                </a>
                <button class="btn btn-secondary">
                    Learn More
                </button>
            </div>
        </div>
        <div class="scroll-indicator">
            <span>Scroll to explore</span>
            <i class="fas fa-chevron-down"></i>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section" id="benefits">
        <div class="container">
            <div class="section-header">
                <h2>Why Choose Farm2Home?</h2>
                <p>Direct from farm to your table with guaranteed freshness</p>
            </div>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h3>100% Organic</h3>
                    <p>Certified organic produce grown without harmful pesticides or chemicals</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-truck-fast"></i>
                    </div>
                    <h3>Fast Delivery</h3>
                    <p>Farm-fresh products delivered to your doorstep within 24 hours</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <h3>Fair Trade</h3>
                    <p>Supporting local farmers with fair prices and sustainable practices</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-check"></i>
                    </div>
                    <h3>Quality Assured</h3>
                    <p>Every product is inspected for quality and freshness before delivery</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products-section" id="products">
        <div class="container">
            <div class="section-header">
                <h2>Fresh Products</h2>
                <p>Explore our selection of farm-fresh organic produce</p>
            </div>
            
            <div class="products-grid">
                <div class="product-card">
                    <img src="{% static 'images/vegetables/tomato.png' %}" alt="Fresh Tomatoes">
                    <h3>Fresh Tomatoes</h3>
                    <p>Juicy and ripe tomatoes</p>
                </div>
                
                <div class="product-card">
                    <img src="{% static 'images/vegetables/carrot.png' %}" alt="Organic Carrots">
                    <h3>Organic Carrots</h3>
                    <p>Crunchy and sweet carrots</p>
                </div>
                
                <div class="product-card">
                    <img src="{% static 'images/fruits/pineapple.png' %}" alt="Tropical Pineapple">
                    <h3>Tropical Pineapple</h3>
                    <p>Sweet and juicy pineapples</p>
                </div>
                
                <div class="product-card">
                    <img src="{% static 'images/herbs/basil.png' %}" alt="Fresh Basil">
                    <h3>Fresh Basil</h3>
                    <p>Aromatic herb for cooking</p>
                </div>
            </div>
            
            <div class="products-cta">
                <a href="{% url 'main:catalog' %}" class="btn-primary-large">
                    Shop All Products
                    <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Featured Categories Section -->
    <section class="featured-categories-section" id="about">
        <div class="container">
            <div class="section-header">
                <h2>Featured Categories</h2>
                <a href="{% url 'main:catalog' %}" class="view-all-link">View All Categories →</a>
            </div>
            
            <div class="categories-grid">
                <div class="category-card circular">
                    <div class="category-circle">
                        <img src="{% static 'images/vegetables/carrot.png' %}" alt="Fresh Vegetables">
                    </div>
                    <h3>Vegetables</h3>
                </div>
                
                <div class="category-card circular">
                    <div class="category-circle">
                        <img src="{% static 'images/fruits/pineapple.png' %}" alt="Fresh Fruits">
                    </div>
                    <h3>Fresh Fruits</h3>
                </div>
            </div>
        </div>
    </section>

    <!-- Promotional Cards Section -->
    <section class="promo-section">
        <div class="container">
            <div class="promo-cards-grid">
                <!-- Discount Card 1 -->
                <div class="discount-card discount-card-1">
                    <div class="discount-badge">Flat 20% Discount</div>
                    <h3>Purely Fresh Vegetables</h3>
                    <p>Premium quality vegetables at special price</p>
                    <a href="{% url 'main:catalog' %}" class="promo-btn">
                        Shop Now →
                    </a>
                    <div class="promo-image">
                        <img src="{% static 'images/vegetables/carrot.png' %}" alt="Fresh Vegetables">
                    </div>
                </div>
                
                <!-- Discount Card 2 -->
                <div class="discount-card discount-card-2">
                    <div class="discount-badge">Flat 25% Discount</div>
                    <h3>Fresh Fruits, Pure Quality</h3>
                    <p>Handpicked fresh fruits directly from farms</p>
                    <a href="{% url 'main:catalog' %}" class="promo-btn">
                        Shop Now →
                    </a>
                    <div class="promo-image">
                        <img src="{% static 'images/fruits/pineapple.png' %}" alt="Fresh Fruits">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Summer Discount Section -->
    <section class="summer-discount-section">
        <div class="container">
            <div class="summer-discount-card">
                <div class="discount-content">
                    <h2>Summer Discount</h2>
                    <p>SPECIAL OFFER ON FRESH PRODUCE</p>
                    
                    <div class="countdown-timer">
                        <div class="timer-item">
                            <span class="timer-number">04</span>
                            <span class="timer-label">Days</span>
                        </div>
                        <div class="timer-item">
                            <span class="timer-number">14</span>
                            <span class="timer-label">Hours</span>
                        </div>
                        <div class="timer-item">
                            <span class="timer-number">48</span>
                            <span class="timer-label">Minutes</span>
                        </div>
                        <div class="timer-item">
                            <span class="timer-number">18</span>
                            <span class="timer-label">Seconds</span>
                        </div>
                    </div>
                    
                    <a href="{% url 'main:catalog' %}" class="summer-btn">
                        Shop Now
                    </a>
                </div>
                <div class="discount-image">
                    <img src="{% static 'images/vegetables/tomato.png' %}" alt="Summer Vegetables">
                </div>
            </div>
        </div>
    </section>

    <!-- Deals of the Day Section -->
    <section class="deals-section">
        <div class="container">
            <div class="section-header">
                <h2>Deals of the Day</h2>
            </div>
            
            <div class="deals-grid">
                <div class="deal-card">
                    <div class="deal-image">
                        <img src="{% static 'images/vegetables/tomato.png' %}" alt="Fresh Tomatoes">
                    </div>
                    <h4>Fresh Tomatoes</h4>
                    <div class="deal-price">
                        <span class="original-price">Rs. 350</span>
                        <span class="deal-price-value">Rs. 199</span>
                    </div>
                    <div class="deal-discount">Save 43%</div>
                    <button class="deal-btn">Add to Cart</button>
                </div>
                
                <div class="deal-card">
                    <div class="deal-image">
                        <img src="{% static 'images/vegetables/carrot.png' %}" alt="Organic Carrots">
                    </div>
                    <h4>Organic Carrots</h4>
                    <div class="deal-price">
                        <span class="original-price">Rs. 280</span>
                        <span class="deal-price-value">Rs. 179</span>
                    </div>
                    <div class="deal-discount">Save 36%</div>
                    <button class="deal-btn">Add to Cart</button>
                </div>
                
                <div class="deal-card">
                    <div class="deal-image">
                        <img src="{% static 'images/fruits/pineapple.png' %}" alt="Tropical Pineapple">
                    </div>
                    <h4>Tropical Pineapple</h4>
                    <div class="deal-price">
                        <span class="original-price">Rs. 450</span>
                        <span class="deal-price-value">Rs. 299</span>
                    </div>
                    <div class="deal-discount">Save 34%</div>
                    <button class="deal-btn">Add to Cart</button>
                </div>
                
                <div class="deal-card">
                    <div class="deal-image">
                        <img src="{% static 'images/herbs/basil.png' %}" alt="Fresh Basil">
                    </div>
                    <h4>Fresh Basil</h4>
                    <div class="deal-price">
                        <span class="original-price">Rs. 180</span>
                        <span class="deal-price-value">Rs. 119</span>
                    </div>
                    <div class="deal-discount">Save 34%</div>
                    <button class="deal-btn">Add to Cart</button>
                </div>
            </div>
        </div>
    </section>

    <!-- B2B Bulk Buying Section -->
    <section class="b2b-section">
        <div class="container">
            <div class="b2b-card">
                <div class="b2b-content">
                    <h2>Business to Business</h2>
                    <h3>Buy in Bulk</h3>
                    <p>Get exclusive wholesale prices for your business. Direct from farm to your store.</p>
                    <ul class="b2b-features">
                        <li><i class="fas fa-check"></i> Wholesale Pricing</li>
                        <li><i class="fas fa-check"></i> Bulk Orders</li>
                        <li><i class="fas fa-check"></i> Dedicated Support</li>
                        <li><i class="fas fa-check"></i> Fast Delivery</li>
                    </ul>
                    <a href="#contact" class="b2b-btn">Contact Sales Team</a>
                </div>
                <div class="b2b-image">
                    <img src="{% static 'images/vegetables/okra.png' %}" alt="Bulk Vegetables">
                </div>
            </div>
        </div>
    </section>

    <!-- Modal Backdrop -->
    <div id="modalBackdrop" class="modal-backdrop"></div>

    <!-- Fresh Login & Signup Modal -->
    <div id="authModal" class="auth-modal-new">
        <div class="modal-container">
            <!-- Left Side - Illustration -->
            <div class="modal-left-side">
                <img src="{% static 'images/left.png' %}" alt="Farm Illustration" class="modal-illustration">
            </div>

            <!-- Right Side - Form -->
            <div class="modal-right-side">
                <button type="button" class="modal-close-btn" onclick="closeAuthModal()">&times;</button>
                
                <!-- Login Form -->
                <div id="loginForm" class="auth-form-section">
                    <div class="form-header">
                        <h1 class="form-title">Login</h1>
                        <p class="form-subtitle">Welcome back to Farm2Home</p>
                    </div>

                    <form id="loginFormElement" method="POST" action="{% url 'main:login' %}" class="form-container">
                        {% csrf_token %}
                        
                        <!-- Django Messages -->
                        {% if messages %}
                            <div class="messages-box">
                                {% for message in messages %}
                                    <div class="message message-{{ message.tags }}">
                                        <i class="fas fa-{% if message.tags == 'error' %}exclamation-circle{% elif message.tags == 'success' %}check-circle{% else %}info-circle{% endif %}"></i>
                                        {{ message }}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}

                        <div class="form-group">
                            <label for="login_email">Email Address</label>
                            <div class="input-field">
                                <i class="fas fa-envelope"></i>
                                <input type="email" id="login_email" name="email" placeholder="your@email.com" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="login_password">Password</label>
                            <div class="input-field password-field">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="login_password" name="password" placeholder="Enter your password" required>
                                <button type="button" class="toggle-password" onclick="togglePassword('login_password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-row">
                            <label class="checkbox-field">
                                <input type="checkbox" name="rememberMe">
                                <span>Remember me</span>
                            </label>
                            <a href="#" class="forgot-password-link">Forgot password?</a>
                        </div>

                        <button type="submit" class="submit-btn">Login</button>
                    </form>

                    <div class="form-footer">
                        <p>Don't have an account? <button type="button" class="switch-form-btn" onclick="switchToSignup()">Sign up</button></p>
                    </div>
                </div>

                <!-- Signup Form (Hidden by default) -->
                <div id="signupForm" class="auth-form-section" style="display: none;">
                    <div class="form-header">
                        <h1 class="form-title">Sign Up</h1>
                        <p class="form-subtitle">Create your Farm2Home account</p>
                    </div>

                    <form id="signupFormElement" method="POST" action="{% url 'main:signup' %}" class="form-container">
                        {% csrf_token %}
                        
                        <!-- Django Messages -->
                        {% if messages %}
                            <div class="messages-box">
                                {% for message in messages %}
                                    <div class="message message-{{ message.tags }}">
                                        <i class="fas fa-{% if message.tags == 'error' %}exclamation-circle{% elif message.tags == 'success' %}check-circle{% else %}info-circle{% endif %}"></i>
                                        {{ message }}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}

                        <div class="form-group">
                            <label for="signup_fullname">Full Name</label>
                            <div class="input-field">
                                <i class="fas fa-user"></i>
                                <input type="text" id="signup_fullname" name="fullName" placeholder="John Doe" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="signup_email">Email Address</label>
                            <div class="input-field">
                                <i class="fas fa-envelope"></i>
                                <input type="email" id="signup_email" name="email" placeholder="your@email.com" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="signup_phone">Phone Number</label>
                            <div class="input-field">
                                <i class="fas fa-phone"></i>
                                <input type="tel" id="signup_phone" name="phone" placeholder="+92 300 1234567" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="signup_address">Address</label>
                            <div class="input-field">
                                <i class="fas fa-map-marker-alt"></i>
                                <input type="text" id="signup_address" name="address" placeholder="123 Street, City" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="signup_password">Password</label>
                            <div class="input-field password-field">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="signup_password" name="password" placeholder="Create a strong password" required>
                                <button type="button" class="toggle-password" onclick="togglePassword('signup_password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="signup_confirm_password">Confirm Password</label>
                            <div class="input-field password-field">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="signup_confirm_password" name="confirmPassword" placeholder="Confirm your password" required>
                                <button type="button" class="toggle-password" onclick="togglePassword('signup_confirm_password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <label class="checkbox-field">
                            <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
                            <span>I agree to the Terms & Conditions</span>
                        </label>

                        <button type="submit" class="submit-btn">Create Account</button>
                    </form>

                    <div class="form-footer">
                        <p>Already have an account? <button type="button" class="switch-form-btn" onclick="switchToLogin()">Login</button></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" id="footerSection">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-leaf"></i>
                        <span>FARM2HOME</span>
                    </div>
                    <p>Bringing fresh, organic produce directly from farm to your table.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="{% url 'main:catalog' %}">Products</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="{% url 'main:account_home' %}">My Account</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Get In Touch</h4>
                    <form class="footer-contact-form">
                        <input type="text" placeholder="Your Name" required>
                        <input type="email" placeholder="Your Email" required>
                        <textarea placeholder="Your Message" rows="3" required></textarea>
                        <button type="submit" class="btn-primary">Send Message</button>
                    </form>
                </div>
                
                <div class="footer-section">
                    <h4>Contact Us</h4>
                    <ul>
                        <li><i class="fas fa-envelope"></i> hello@farm2home.com</li>
                        <li><i class="fas fa-phone"></i> +92 (300) 567-890</li>
                        <li><i class="fas fa-map-marker-alt"></i> Karachi, Pakistan</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Farm2Home. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script src="{% static 'js/notifications.js' %}"></script>
    <script src="{% static 'js/countdown.js' %}"></script>
    <script>
        // Apply footer background image
        document.getElementById('footerSection').style.backgroundImage = "url('{% static 'images/footer.png' %}')";
        document.getElementById('footerSection').style.backgroundSize = "cover";
        document.getElementById('footerSection').style.backgroundPosition = "center";
        document.getElementById('footerSection').style.backgroundAttachment = "fixed";

        // ================================
        // FRESH AUTH MODAL FUNCTIONS
        // ================================

        function openLoginModal() {
            const modal = document.getElementById('authModal');
            const backdrop = document.getElementById('modalBackdrop');
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            
            // Show login form, hide signup form
            loginForm.style.display = 'block';
            signupForm.style.display = 'none';
            
            // Show modal
            modal.classList.add('active');
            backdrop.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function openSignupModal() {
            const modal = document.getElementById('authModal');
            const backdrop = document.getElementById('modalBackdrop');
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            
            // Show signup form, hide login form
            loginForm.style.display = 'none';
            signupForm.style.display = 'block';
            
            // Show modal
            modal.classList.add('active');
            backdrop.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeAuthModal(event) {
            // If event exists and it's not the backdrop, don't close
            if (event && event.target !== document.getElementById('modalBackdrop')) {
                return;
            }
            
            const modal = document.getElementById('authModal');
            const backdrop = document.getElementById('modalBackdrop');
            
            modal.classList.remove('active');
            backdrop.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function switchToLogin() {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            
            loginForm.style.display = 'block';
            signupForm.style.display = 'none';
        }

        function switchToSignup() {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            
            loginForm.style.display = 'none';
            signupForm.style.display = 'block';
        }

        function togglePassword(fieldId) {
            const input = document.getElementById(fieldId);
            const button = event.currentTarget;
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Close modal on backdrop click
        document.getElementById('modalBackdrop').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAuthModal(e);
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('authModal');
                if (modal.classList.contains('active')) {
                    closeAuthModal();
                }
            }
        });

        // Form validation and submission
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in and update UI accordingly
            updateAuthButtonsVisibility();
            
            const loginFormElement = document.getElementById('loginFormElement');
            const signupFormElement = document.getElementById('signupFormElement');

            // Login form validation and submission
            if (loginFormElement) {
                loginFormElement.addEventListener('submit', async function(e) {
                    e.preventDefault(); // Always prevent default to handle via API
                    
                    const email = document.getElementById('login_email').value.trim();
                    const password = document.getElementById('login_password').value.trim();
                    
                    if (!email || !password) {
                        alert('Please fill in all fields');
                        return;
                    }

                    try {
                        const response = await fetch('/api/auth/login/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCsrfToken()
                            },
                            body: JSON.stringify({ email, password })
                        });

                        const data = await response.json();

                        if (response.ok && data.success === true) {
                            // Store customer data in localStorage
                            localStorage.setItem('customer_id', data.customer_id);
                            localStorage.setItem('customer_name', data.name);
                            localStorage.setItem('customer_email', data.email);
                            
                            // Show success message
                            alert('Login successful! Welcome back, ' + data.name);
                            
                            // Close the modal
                            closeAuthModal();
                            
                            // Hide login and signup buttons
                            updateAuthButtonsVisibility();
                        } else {
                            // Show error message
                            alert(data.error || data.message || 'Login failed. Please check your credentials.');
                        }
                    } catch (error) {
                        console.error('Login error:', error);
                        alert('An error occurred during login. Please try again.');
                    }
                });
            }

            // Helper function to get CSRF token
            function getCsrfToken() {
                const name = 'csrftoken';
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    cookie = cookie.trim();
                    if (cookie.startsWith(name + '=')) {
                        return cookie.substring(name.length + 1);
                    }
                }
                return '';
            }
            
            // Function to update auth buttons visibility based on login status
            function updateAuthButtonsVisibility() {
                const customerId = localStorage.getItem('customer_id');
                const loginBtn = document.querySelector('.login-btn');
                const signupBtn = document.querySelector('.signup-btn');
                
                if (customerId) {
                    // User is logged in - hide login and signup buttons
                    if (loginBtn) loginBtn.style.display = 'none';
                    if (signupBtn) signupBtn.style.display = 'none';
                } else {
                    // User is not logged in - show login and signup buttons
                    if (loginBtn) loginBtn.style.display = '';
                    if (signupBtn) signupBtn.style.display = '';
                }
            }

            // Signup form validation and submission
            if (signupFormElement) {
                signupFormElement.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const fullname = document.getElementById('signup_fullname').value.trim();
                    const email = document.getElementById('signup_email').value.trim();
                    const phone = document.getElementById('signup_phone').value.trim();
                    const address = document.getElementById('signup_address').value.trim();
                    const password = document.getElementById('signup_password').value.trim();
                    const confirmPassword = document.getElementById('signup_confirm_password').value.trim();
                    const agreeTerms = document.getElementById('agreeTerms').checked;
                    
                    // Validate all fields are filled
                    if (!fullname || !email || !phone || !address || !password || !confirmPassword) {
                        alert('❌ Please fill in all fields');
                        return;
                    }
                    
                    // Validate email format
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        alert('❌ Please enter a valid email address');
                        return;
                    }
                    
                    // Validate password length
                    if (password.length < 6) {
                        alert('❌ Password must be at least 6 characters long');
                        return;
                    }
                    
                    // Validate passwords match
                    if (password !== confirmPassword) {
                        alert('❌ Passwords do not match');
                        return;
                    }
                    
                    // Validate terms checkbox
                    if (!agreeTerms) {
                        alert('❌ Please agree to Terms & Conditions');
                        return;
                    }
                    
                    try {
                        const response = await fetch('/api/auth/signup/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCsrfToken()
                            },
                            body: JSON.stringify({
                                name: fullname,
                                email: email,
                                phone: phone,
                                address: address,
                                password: password
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok && data.success === true) {
                            // Store customer data in localStorage
                            localStorage.setItem('customer_id', data.customer_id);
                            localStorage.setItem('customer_name', data.name);
                            localStorage.setItem('customer_email', data.email);
                            
                            // Show success message
                            alert('✅ Signup successful! Welcome, ' + data.name + '!');
                            
                            // Close the modal
                            closeAuthModal();
                            
                            // Hide login and signup buttons
                            updateAuthButtonsVisibility();
                            
                            // Reset form
                            signupFormElement.reset();
                        } else {
                            // Show specific error message
                            const errorMsg = data.error || data.message || 'Signup failed. Please try again.';
                            
                            // Add emoji based on error type
                            if (errorMsg.includes('Email already exists') || errorMsg.includes('Phone number already registered')) {
                                alert('⚠️ ' + errorMsg);
                            } else {
                                alert('❌ ' + errorMsg);
                            }
                        }
                    } catch (error) {
                        console.error('Signup error:', error);
                        alert('An error occurred during signup. Please try again.');
                    }
                });
            }

            // Auto-open modal if there are messages from server
            const messagesBox = document.querySelector('.messages-box');
            if (messagesBox && messagesBox.textContent.trim()) {
                // Check which form should be shown
                if (document.getElementById('loginForm').style.display !== 'none' || 
                    document.getElementById('loginForm').style.display === '') {
                    setTimeout(() => openLoginModal(), 100);
                }
            }

            // Handle scrolling to hash on page load (e.g., #footerSection)
            if (window.location.hash) {
                // Wait for page to fully load
                setTimeout(() => {
                    const hash = window.location.hash;
                    const targetElement = document.querySelector(hash);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
        });
    </script>
</body>
</html>

